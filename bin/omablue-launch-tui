#!/bin/bash
# omablue-launch-tui
# The engine behind the TUI installer.
# Maps Installer 'Window Style' -> Foot 'App ID' -> Sway Rules

# 1. Capture Arguments from the .desktop file
# Arg 1: The App ID (e.g., "TUI.float" or "TUI.tile")
APP_ID="${1:-TUI.tile}"
# Arg 2: The Command to run (e.g., "nvim", "btop")
CMD_EXEC="$2"

# 2. Robust PATH Setup
# Ensures we find Homebrew binaries and local scripts
export PATH="$HOME/.local/share/omablue/bin:$HOME/.local/bin:/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:/usr/local/bin:/usr/bin:/bin:$PATH"

# 3. Validation
if [[ -z "$CMD_EXEC" ]]; then
  notify-send -u critical "Omablue Error" "No command provided to launcher."
  exit 1
fi

# Security: reject shell metacharacters to prevent command injection
if [[ "$CMD_EXEC" =~ [\;\&\|\`\$\(] ]]; then
  notify-send -u critical "Omablue Error" "Invalid command in launcher."
  exit 1
fi

# 4. Atomic Execution
# We use 'exec' to replace the shell process with foot.
# --app-id: Sets the Wayland app_id so Sway knows if it should float or tile.
# env PATH="$PATH": Passes our robust PATH into the terminal session.
exec foot --app-id="$APP_ID" sh -c "$CMD_EXEC"
